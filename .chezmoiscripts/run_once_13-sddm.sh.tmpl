{{ if .variables.sddm -}}
#!/bin/bash

echo "${NOTE} - Running 15-sddm.sh"

# Sourcing helper functions and variables
source "$HOME/.local/share/chezmoi/.chezmoiscripts/run_00-helper.sh"

# ðŸ’« https://github.com/JaKooLit ðŸ’« #
# # SDDM Log-in Manager #

sddm=(
    # Base package
    sddm

    # Themes
    catppuccin-sddm-theme-mocha

    # Dependencies
    qt6-5compat
    qt6-declarative
    qt6-svg
    qt5-declarative
)

## WARNING: DO NOT EDIT BEYOND THIS LINE IF YOU DON'T KNOW WHAT YOU ARE DOING! ##

# Set the name of the log file to include the current date and time
LOG="$HOME/.dotfiles/logs/install-$(date +%d-%H%M%S)_sddm.log"

# Install SDDM and SDDM theme
printf "${NOTE} Installing sddm and dependencies........\n"
for package in "${sddm[@]}"; do
    install_package "$package" 2>&1 | tee -a "$LOG"
    [ $? -ne 0 ] && {
        echo -e "\e[1A\e[K${ERROR} - $package Package installation failed, Please check the installation logs"
        exit 1
    }
done

# Check if other login managers installed and disabling its service before enabling sddm
for login_manager in lightdm gdm lxdm lxdm-gtk3; do
    if pacman -Qs "$login_manager" >/dev/null; then
        echo "disabling $login_manager..."
        sudo systemctl disable "$login_manager.service" 2>&1 | tee -a "$LOG"
    fi
done

printf " Activating sddm service........\n"
sudo systemctl enable sddm

# Set up SDDM
echo -e "${NOTE} Setting up the login screen."
sddm_conf_dir=/etc/sddm.conf.d
[ ! -d "$sddm_conf_dir" ] && {
    printf "$CAT - $sddm_conf_dir not found, creating...\n"
    sudo mkdir "$sddm_conf_dir" 2>&1 | tee -a "$LOG"
}

wayland_sessions_dir=/usr/share/wayland-sessions
[ ! -d "$wayland_sessions_dir" ] && {
    printf "$CAT - $wayland_sessions_dir not found, creating...\n"
    sudo mkdir "$wayland_sessions_dir" 2>&1 | tee -a "$LOG"
}
sudo cp assets/hyprland.desktop "$wayland_sessions_dir/" 2>&1 | tee -a "$LOG"

printf "${OK} SDDM installed successfully!\n" | tee -a "$LOG"
{{ end }}
